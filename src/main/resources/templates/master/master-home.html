<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>



    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-3d.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script>

        $(document).ready(function(){
            $('.datepicker').datepicker({
                format: 'yyyy-mm-dd',
                defaultDate: $("#date").val(),
                autoClose: true,
                disableDayFn:function (date){
                    var days = null;
                    $(document).ready(function (){
                        days = $("#daysAttribute");
                        console.log(days.val())
                    });
                    if(days != null){
                        console.log(date.toDateString())
                        return !days.val().includes(date.toDateString());
                    }
                }
            });
        });

        $(function (){

            $('#schedule').on('click', function (){
                document.getElementById('date').click();
            })

            $('#date').on('change', function (date){
                var day = $(this).val();
                console.log(day);
                if(day){
                    window.location = "/master-home/"+day;
                }
            })
        })

    </script>
</head>
<body>

    <nav>
        <div class="nav-wrapper grey darken-4">
            <a href="/" class="brand-logo center">Master page</a>
            <ul id="nav-mobile" class="left hide-on-med-and-down"></ul>
        </div>
    </nav>

    <div class="col s2 center">
        <h6 th:text="${date.getDay().toString().substring(0, 10)}"></h6>
        <button onclick="document.getElementById('date').click()" style="border: none; background: none; padding: 0;">
            <i class="medium material-icons light-blue-text">schedule</i>
        </button>
        <input hidden="hidden" th:value="${date.getDay().toString().substring(0, 10)}" name="date" id="date" type="text" class="datepicker">
    </div>


    <div class="row" style="display: inline-block">
        <h4 style="display: inline-block; margin-left: 90px">Name: <span th:text="${masterName}">*</span></h4>
        <h4 style="display: inline-block; margin-left: 90px">Rating: <span th:text="${rating}">*</span></h4>
        <h4 style="display: inline-block; margin-left: 90px">Requests: <span th:text="${requestListTotalSize}"></span>
            <a><i class="material-icons">dvr</i></a>
        </h4>
        <h4 style="display: inline-block; margin-left: 90px">Clients : <span th:text="${clientSize}"></span></h4>
        <h4 style="display: inline-block; margin-left: 90px">Feedbacks : <span th:text="${feedbackList}"></span>
            <a><i class="material-icons">dvr</i></a>
        </h4>
    </div>

    <input class="hide" id="daysAttribute" th:value="${workDayList}"/>

    <div id="container" style="height: 400px"></div>
    <script th:inline="javascript">
        Highcharts.chart('container', {
            chart : {
                type : 'pie',
                options3d : {
                    enabled : true,
                    alpha : 50,
                    beta : 0
                }
            },
            title : {
                text : 'Result Status'
            },
            tooltip : {
                pointFormat : '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions : {
                pie : {
                    allowPointSelect : true,
                    cursor : 'pointer',
                    depth : 35,
                    dataLabels : {
                        enabled : true,
                        format : '{point.name}'
                    }
                }
            },
            series : [ {
                type : 'pie',
                name : 'Ratio',
                data : [ [ 'Success', [[${pass}]] ], [ 'Failure', [[${fail}]] ]  ]
            } ]
        });
    </script>

    <table class="centered">
        <thead>
        <tr>
            <th>Time</th>
            <th>Procedure</th>
            <th>Client</th>
            <th>Done</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="request : ${requestListByDate}">
            <td th:text="${request.time}"></td>
            <td th:text="${request.procedure}" ></td>
            <td th:text="${request.client}"></td>
            <div th:switch="${request.done}">
                <td th:case="true"><img src="/static/img/core-img/done.png"></td>
                <td th:case="false"><img src="/static/img/core-img/notdone.png"></td>
            </div>
        </tr>
        </tbody>
    </table>

    <span th:text="${date.getFromTime()}"></span>
    <span th:text="${date.getTillTime()}"></span>
</body>
</html>